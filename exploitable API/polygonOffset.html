<html>
<head><title>webgl test</title></head>
<body>


<canvas id='myCanvas' width='256' height='256'></canvas>
<div id="res"> </div>
<script>
String.prototype.hashCode = function() {
  var hash = 0, i, chr;
  if (this.length === 0) return hash;
  for (i = 0; i < this.length; i++) {
	chr   = this.charCodeAt(i);
	hash  = ((hash << 5) - hash) + chr;
	hash |= 0; // Convert to 32bit integer
  }
  return hash;
};
</script>	


<script>


var canvas = document.getElementById("myCanvas");
var gl = canvas.getContext('webgl',{ antialias: false, depth: true });

if (!gl) {
	console.log('can not use webgl');
}

gl.getExtension('EXT_frag_depth');
gl.enable(gl.DEPTH_TEST);

var debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
console.log( gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) );
console.log( gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) );

function loadShader(type, shaderSource) {
  var shader = gl.createShader(type);
  gl.shaderSource(shader, shaderSource);
  gl.compileShader(shader);

  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
      alert("Error compiling shader" + gl.getShaderInfoLog(shader));
      gl.deleteShader(shader);   
      return null;
  }
  return shader;  
}


var vertexShaderSource = `  
attribute vec3 pos;
void main()
{
    gl_Position = vec4(pos, 1);
}
`
	
var fragmentShaderSource = `
precision mediump float;
uniform vec4 col;

void main()
{
    gl_FragColor = col;
}                                     
`

var flatSquare = [-1, -1, 0,-1, 1, 0, 1, -1, 0, 1, 1, 0];
var slantedSquare = [-1, -1, -0.5, -1,  1, -0.5,  1, -1, 0.5, 1,  1, 0.5];
var red = [1, 0, 0, 1];
var green = [0, 1, 0, 1];
var blue = [0, 0, 1, 1];

var vertexShader = loadShader(gl.VERTEX_SHADER, vertexShaderSource);
var fragmentShader = loadShader(gl.FRAGMENT_SHADER, fragmentShaderSource);

var shaderProgram = gl.createProgram();
gl.attachShader(shaderProgram, vertexShader);
gl.attachShader(shaderProgram, fragmentShader);
gl.linkProgram(shaderProgram);

if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
	alert("Failed to setup shaders");
}

gl.useProgram(shaderProgram);
var colLoc = gl.getUniformLocation(shaderProgram, 'col');

gl.enableVertexAttribArray(0);
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);

function draw(gl, arr, colLoc, col)
{
    var vertices = new Float32Array(arr);
    var vertBuf = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, vertBuf);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
    gl.vertexAttribPointer(0, 3, gl.FLOAT, false, 0, 0);
    gl.uniform4fv(colLoc, col);
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, vertices.length / 3);
}


gl.clearDepth(0.5);
gl.clearColor(0.0, 0.0, 0.0, 1.0);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);


var x = [0.99,0.67,0.43,0.76,0.79,0.39,0.23,0.95,0.58,0.56,0.38,0.94,0.65,0.88,0.12,0.12,0.85,0.24,0.89,0.47,0.35,0.59,0.80,0.08,0.41,0.64,0.15,0.69,0.89,0.66];
var res = [];

for(let i=0; i<x.length; i=i+3){
	gl.polygonOffset(x[i], x[i+1]);
	gl.clearDepth(x[i+2]);
	gl.clearColor(0.0, 0.0, 0.0, 1.0);
	gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
	draw(gl, slantedSquare, colLoc, blue);
	res.push(canvas.toDataURL().hashCode());
}

var div = document.getElementById('res');
div.innerHTML = "Your fingerprint: "+ res.join('_').hashCode();//canvas.toDataURL().hashCode();

</script>

</body>
</html>